#!/usr/local/bin/python3

#  $$$$$$\$$$$$$$$\      $$\      $$\  $$$$$$\  $$\   $$\ $$$$$$$$\ 
# $$  __$$\__$$  __|     $$$\    $$$ |$$  __$$\ $$ | $$  |$$  _____|
# $$ /  $$ | $$ |        $$$$\  $$$$ |$$ /  $$ |$$ |$$  / $$ |      
# $$$$$$$$ | $$ |$$$$$$\ $$\$$\$$ $$ |$$$$$$$$ |$$$$$  /  $$$$$\    
# $$  __$$ | $$ |\______|$$ \$$$  $$ |$$  __$$ |$$  $$<   $$  __|   
# $$ |  $$ | $$ |        $$ |\$  /$$ |$$ |  $$ |$$ |\$$\  $$ |      
# $$ |  $$ | $$ |        $$ | \_/ $$ |$$ |  $$ |$$ | \$$\ $$$$$$$$\ 
# \__|  \__| \__|        \__|     \__|\__|  \__|\__|  \__|\________|
#
# Make All Scripts in directory
#
# By: AriStehney
#
#

import os
import sys
import time
import crayons

basicscriptstart = """#!/bin/sh
# Auto Generated Script to run all
# Generated by AT-MAKE


"""

if os.path.isfile(os.getcwd()+"/makefile") or os.path.isfile(os.getcwd()+"/Makefile") or os.path.isfile(os.getcwd()+"/MAKEFILE"):
    print("making 'main'...")
    makefile_code = ""
    endcode_script = ""
    print("pulling config...")
    if os.path.isfile(os.getcwd()+"/makefile"):
        with open(os.getcwd()+"/makefile",mode="r") as mk_file:
             makefile_code = mk_file.read()
    if os.path.isfile(os.getcwd()+"/Makefile"):
        with open(os.getcwd()+"/makefile",mode="r") as mk_file:
             makefile_code = mk_file.read()
    if os.path.isfile(os.getcwd()+"/MAKEFILE"):
        with open(os.getcwd()+"/makefile",mode="r") as mk_file:
             makefile_code = mk_file.read()

    print("processing config...")
    makefile_code = makefile_code.split("\n")

    print("preloading source...")
    for word in makefile_code:
        if word.startswith("#") or word=="":
            print("",end="")
        else:
            if not os.path.isfile(os.getcwd()+"/"+word):
                print(crayons.red("preloading failed: source not found"))
                sys.exit()
            time.sleep(0.5)

    for word in makefile_code:
        if word.startswith("#") or word=="":
            print("",end="")
        else:
            print("")
            print("")
            print(crayons.green("adding source '"+str(os.getcwd()+"/"+word+"'..."),bold=True))
            if not os.path.isfile(os.getcwd()+"/"+word):
                print(crayons.red("make: source file not found! Stop."))
                sys.exit()
            endcode_script+="atcc "+word+" -ra\n"
            os.system("cd "+str(os.getcwd()+"/")+" && atcc "+word+" -na")
            time.sleep(0.11)

    with open(os.getcwd()+"/run-all.sh",mode="w") as out_sh:
        out_sh.write(str(basicscriptstart+endcode_script))
    os.system("cd "+str(os.getcwd()+"/")+" && chmod +x run-all.sh")
else:
    print("make: *** no makefile found.  Stop.")
    
